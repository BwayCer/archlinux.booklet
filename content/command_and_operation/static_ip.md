固定網路協定位址
=======


> 2017.11.04



## 頁籤


* [簡介](#簡介)
* [撥號設定](#撥號設定)
* [撥號連線](#撥號連線)
* [附件](#附件)
  * [查詢 IP](#查詢-ip)
  * [分享器設定](#分享器設定)
  * [成功連線後的狀態資訊](#成功連線後的狀態資訊)
    * [netctl 資訊](#netctl-資訊)
    * [pppd 資訊](#pppd-資訊)
* [參考](#參考)



## 簡介


以 PPPoE 撥號方式取得實體固定網路協定位址 IP 。


> 註： 關於中華電信固定 IP 的申請請見
> [非固定制固定IP配發服務](http://service.hinet.net/2004/adslstaticip.php) 。



## 撥號設定


**安裝 `ppp` 程式包：**


```
pacman -S ppp
```

關於 `ppp` 程式包更多資訊可見
[ppp 程式包](/content/command_and_operation/ppp.md) 。

> 註： 無須下載 `rp-pppoe` 程式包。

<br>


**編寫 `/etc/netctl/your_profile`：**


```
Description='Your PPPoE connection'
Interface=eth0
Connection=pppoe
User='***@ip.hinet.net'
Password='Hinet 密碼'

# Always keep a connection established
ConnectionMode='persist'
# Establish connection on demand
#ConnectionMode='demand'
#IdleTimeout=300

# Use default route provided by the peer (default: true)
#DefaultRoute=true
# Use DNS provided by the peer (default: true)
#UsePeerDNS=true

# Override default LCP parameters from /etc/ppp/options
#LCPEchoInterval=15
#LCPEchoFailure=10

# PPPoE options - experts only
#
# PPPoE service name
#PPPoEService=''
# PPPoE access concentrator name
#PPPoEAC=''
# Attach to existing session (sessid:macaddr)
#PPPoESession=''
# Only connect to specified MAC address
#PPPoEMAC=''
# Enable IPv6 support
#PPPoEIP6=yes
```

  * `PPPoE connection`： 描述， 未知用途。
  * `eth0`： 網路介面名稱， 由 `ip addr` 查看。
  * `***@ip.hinet.net`： 撥號帳戶， `@ip.hinet.net` 為登入 Hinet 固定 IP 的用戶名稱。
  * `Hinet 密碼`： Hinet 密碼。

> 註： 配置文件請參考 `/etc/netctl/examples/pppoe`：
>
> ```
> cp /etc/netctl/examples/pppoe /etc/netctl/your_profile
> ```



## 撥號連線


**重置狀態：**

```
ip route del default    # 清除已配置的預設路由
ip link set eth0 down   # 關閉撥號連線所指定的網路介面
```


**查看可用配置文件：**

```
netctl list
```


**撥號連線與關閉：**

```
netctl start your_profile   # 連線
netctl stop your_profile    # 關閉連線
```


**開機時自動撥號連線：**

```
netctl enable your_profile    # 自動連線
netctl disable your_profile   # 關閉自動連線
```



## 附件


### 查詢 IP


可用工具：
  [IP 查詢工具](http://dir.twseo.org/ip-check.php)
  、
  [tool.magiclen.org/ip/](https://tool.magiclen.org/ip/)
  。

```
curl https://tool.magiclen.org/ip/; echo
```



### 分享器設定


由分享器設定較為簡易，
透過內建的 PPPoE 撥號程式取得固定 IP， 並設定防火牆分配網路位置。

更多資訊可見：
  [ZyXEL 分享器的 UDP 通過防火牆設定 - 巴哈姆特](https://forum.gamer.com.tw/Co.php?bsn=22797&sn=10761)
  。



### 成功連線後的狀態資訊


#### netctl 資訊


**查看 `ip addr` 資訊：**

```
2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 00:0c:29:78:6d:ca brd ff:ff:ff:ff:ff:ff
    inet 192.168.***.***/24 brd 192.168.1.255 scope global eth0
       valid_lft forever preferred_lft forever
    inet6 fe80::68ab:3868:***.***/64 scope link
       valid_lft forever preferred_lft forever
6: ppp0: <POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP> mtu 1492 qdisc fq_codel state UNKNOWN group default qlen 3
    link/ppp
    inet 114.***.***.*** peer 168.95.98.254/32 scope global ppp0
       valid_lft forever preferred_lft forever
```


**查看 `ip route` 資訊：**

```
[root@archlinux ~]# ip route
default dev ppp0 scope link
default via 192.168.1.1 dev eth0 src 192.168.***.*** metric 202
168.95.98.254 dev ppp0 proto kernel scope link src 114.***.***.***
192.168.1.0/24 dev eth0 proto kernel scope link src 192.168.***.*** metric 202
```


**查看 `/etc/resolv.conf` 資訊：**

```
# Generated by resolvconf
nameserver 168.95.192.1
nameserver 168.95.1.1
nameserver 192.168.1.1
```



#### pppd 資訊


**查看 `ip addr` 資訊：**

```
2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 00:0c:29:78:6d:ca brd ff:ff:ff:ff:ff:ff
    inet 192.168.***.***/24 brd 192.168.1.255 scope global eth0
       valid_lft forever preferred_lft forever
    inet6 fe80::68ab:3868:***.***/64 scope link
       valid_lft forever preferred_lft forever
3: ppp0: <POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP> mtu 1492 qdisc fq_codel state UNKNOWN group default qlen 3
    link/ppp
    inet 114.***.***.*** peer 168.95.98.254/32 scope global ppp0
       valid_lft forever preferred_lft forever
```


**查看 `ip route` 資訊：**

```
default dev ppp0 scope link
168.95.98.254 dev ppp0 proto kernel scope link src 114.***.***.***
192.168.1.0/24 dev eth0 proto kernel scope link src 192.168.***.*** metric 202
```


**查看 `/etc/resolv.conf` 資訊：**

```
# Generated by resolvconf
nameserver 168.95.192.1
nameserver 168.95.1.1
nameserver 192.168.1.1
```


## 參考


* [HiNet客戶服務 >申請查詢異動 > 安裝設定>固定制安裝設定](http://service.hinet.net/2004/adsl8ip_1.htm)
* [pppoe拨号上网安装Arch Linux - 11386852 - 51CTO技术博客](http://11396852.blog.51cto.com/11386852/1894255)
* [netctl - ArchWiki](https://wiki.archlinux.org/index.php/netctl)

